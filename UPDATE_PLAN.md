# –ü–ª–∞–Ω –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ 152.42.186.191

## –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–∞

### –í–µ—Ä—Å–∏—è –ø—Ä–æ–µ–∫—Ç–∞
- **–ü–æ—Å–ª–µ–¥–Ω–∏–π –∫–æ–º–º–∏—Ç**: `e5a1210` (fix: Block all browser confirm/alert dialogs globally)
- **–í–µ—Ç–∫–∞**: `main`
- **–°—Ç–∞—Ç—É—Å**: –°—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è —Å dev-—Ñ–∞–π–ª–∞–º–∏

### –§–∞–π–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:
- ‚úÖ `docker-compose.dev.yml` - dev –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- ‚úÖ `docker-compose.override.yml.example` - –ø—Ä–∏–º–µ—Ä –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- ‚úÖ `start-docker.sh` - —Å–∫—Ä–∏–ø—Ç –¥–ª—è macOS
- ‚úÖ `backend/init_db.py` - —Å—Ç–∞—Ä—ã–π —Å–∫—Ä–∏–ø—Ç —Å —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- ‚úÖ `INIT_DATA.md` - –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- ‚úÖ `PRODUCTION_CHECKLIST.md` - —É–¥–∞–ª–µ–Ω –≤ –Ω–æ–≤–æ–º –∫–æ–º–º–∏—Ç–µ
- ‚úÖ `QUICKSTART_DOCKER.md` - —É–¥–∞–ª–µ–Ω –≤ –Ω–æ–≤–æ–º –∫–æ–º–º–∏—Ç–µ
- ‚úÖ `SECURITY_AUDIT.md` - —É–¥–∞–ª–µ–Ω –≤ –Ω–æ–≤–æ–º –∫–æ–º–º–∏—Ç–µ

### –§–∞–π–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ—è–≤—è—Ç—Å—è –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:
- ‚úÖ `backend/init_prod_db.py` - –Ω–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

### –°–æ—Å—Ç–æ—è–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
- ‚úÖ **Backend**: –†–∞–±–æ—Ç–∞–µ—Ç (healthy), –ø–æ—Ä—Ç 8000
- ‚úÖ **Frontend**: –†–∞–±–æ—Ç–∞–µ—Ç, –ø–æ—Ä—Ç 3000
- ‚úÖ **PostgreSQL**: –†–∞–±–æ—Ç–∞–µ—Ç (healthy), –ø–æ—Ä—Ç 5432

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- **–î–∞–Ω–Ω—ã–µ**: 15 –¥–µ—Å–µ—Ä—Ç–æ–≤, 2 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **–¢–∏–ø**: PostgreSQL (production-ready)
- **–°—Ç–∞—Ç—É—Å**: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –õ–æ–∫–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- `backend/requirements.txt` - –¥–æ–±–∞–≤–ª–µ–Ω `psycopg2-binary==2.9.9`
  - ‚úÖ –¢–µ–ø–µ—Ä—å –¥–æ–±–∞–≤–ª–µ–Ω –≤ –Ω–æ–≤—ã–π –∫–æ–¥, –Ω–µ –Ω—É–∂–Ω–æ –ø—Ä–∏–º–µ–Ω—è—Ç—å –≤—Ä—É—á–Ω—É—é

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- ‚úÖ `.env` —Ñ–∞–π–ª –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ (PostgreSQL, SECRET_KEY, CORS)
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `docker compose` (–Ω–µ `docker-compose`)

---

## –ü–ª–∞–Ω –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

### –≠—Ç–∞–ø 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏ —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ

1. **–°–æ–∑–¥–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:**
   ```bash
   ssh root@152.42.186.191
   cd /var/www/catalog
   docker compose exec postgres pg_dump -U catalog_user catalog_db > /root/catalog_backup_$(date +%Y%m%d_%H%M%S).sql
   ```

2. **–°–æ–∑–¥–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:**
   ```bash
   cp backend/.env /root/catalog_env_backup_$(date +%Y%m%d_%H%M%S).env
   cp docker-compose.yml /root/catalog_compose_backup_$(date +%Y%m%d_%H%M%S).yml
   ```

3. **–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
   ```bash
   git stash push -m "Local changes: psycopg2-binary in requirements.txt"
   # –ò–ª–∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å diff:
   git diff backend/requirements.txt > /root/requirements_diff.patch
   ```

### –≠—Ç–∞–ø 2: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞

4. **–ü–æ–ª—É—á–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
   ```bash
   git fetch origin
   git pull origin main
   ```

5. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
   ```bash
   # psycopg2-binary —É–∂–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ –Ω–æ–≤–æ–º –∫–æ–¥–µ
   grep psycopg2-binary backend/requirements.txt
   ```

### –≠—Ç–∞–ø 3: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

6. **–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã (–±–µ–∑ —É–¥–∞–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö):**
   ```bash
   docker compose down
   ```

7. **–ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑—ã —Å –Ω–æ–≤—ã–º –∫–æ–¥–æ–º:**
   ```bash
   docker compose build --no-cache
   ```

8. **–ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã:**
   ```bash
   docker compose --profile production up -d
   ```

### –≠—Ç–∞–ø 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –æ—á–∏—Å—Ç–∫–∞

9. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤:**
   ```bash
   docker compose ps
   docker compose logs --tail=50 backend
   ```

10. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å:**
    ```bash
    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å API
    curl http://localhost:8000/health
    
    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
    docker compose exec backend python -c "from app.database import SessionLocal; from app.models import Dessert, User; db = SessionLocal(); print(f'Desserts: {db.query(Dessert).count()}'); print(f'Users: {db.query(User).count()}'); db.close()"
    ```

11. **–£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è —á–∏—Å—Ç–æ—Ç—ã):**
    ```bash
    rm -f docker-compose.dev.yml
    rm -f docker-compose.override.yml.example
    rm -f start-docker.sh
    rm -f backend/init_db.py
    rm -f INIT_DATA.md
    rm -f PRODUCTION_CHECKLIST.md
    rm -f QUICKSTART_DOCKER.md
    rm -f SECURITY_AUDIT.md
    ```

12. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –Ω–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –Ω–∞ –º–µ—Å—Ç–µ:**
    ```bash
    ls -la backend/init_prod_db.py
    ```

---

## –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### ‚ö†Ô∏è –ö—Ä–∏—Ç–∏—á–Ω–æ:
1. **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –±—É–¥–µ—Ç –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∞** - –≤—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—Ç—Å—è
2. **entrypoint.sh –æ–±–Ω–æ–≤–ª–µ–Ω** - —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `init_prod_db.py` –≤–º–µ—Å—Ç–æ `init_db.py`
3. **–ú–∞—Ä–∫–µ—Ä `.db_initialized`** - –µ—Å–ª–∏ –æ–Ω —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω–µ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –ø–æ–≤—Ç–æ—Ä–Ω–æ
4. **psycopg2-binary** - —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω –≤ –Ω–æ–≤—ã–π –∫–æ–¥, –Ω–µ —Ç—Ä–µ–±—É–µ—Ç —Ä—É—á–Ω–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è

### ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ:
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–µ –∑–∞—Ç—Ä–æ–Ω–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ PostgreSQL
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è `.env` –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –≤ `uploads/` —Å–æ—Ö—Ä–∞–Ω—è—Ç—Å—è (–µ—Å–ª–∏ –µ—Å—Ç—å)

### üîÑ –û—Ç–∫–∞—Ç (–µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ–π–¥–µ—Ç –Ω–µ —Ç–∞–∫):
```bash
# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏
docker compose down
docker compose exec postgres psql -U catalog_user catalog_db < /root/catalog_backup_YYYYMMDD_HHMMSS.sql
docker compose --profile production up -d
```

---

## –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

–ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—É –∏–∑ Makefile:
```bash
make deploy
```

–ù–æ –Ω—É–∂–Ω–æ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ:
1. `deploy.env` –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ
2. –õ–æ–∫–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ `requirements.txt` –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –ø–æ—Å–ª–µ `git pull`

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

1. ‚úÖ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∑–∞–ø—É—â–µ–Ω—ã –∏ healthy
2. ‚úÖ API –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ `/health`
3. ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–∞–Ω–Ω—ã–µ (15 –¥–µ—Å–µ—Ä—Ç–æ–≤, 2 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
4. ‚úÖ Frontend –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 3000
5. ‚úÖ Backend –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 8000
6. ‚úÖ –°—Ç–∞—Ä—ã–µ dev-—Ñ–∞–π–ª—ã —É–¥–∞–ª–µ–Ω—ã
7. ‚úÖ –ù–æ–≤—ã–π `init_prod_db.py` –Ω–∞ –º–µ—Å—Ç–µ

